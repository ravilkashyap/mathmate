<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gallery — Math‑Mate</title>
    <meta name="description"
        content="Gallery of Math‑Mate Tuition Centre: photos and videos from classes, workshops, and events in Yelahanka, Bengaluru." />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Baloo+2:wght@600;700&display=swap"
        rel="stylesheet">
</head>

<body class="min-h-screen flex flex-col bg-white text-[#1F2937]">
    <header data-shared></header>

    <main class="flex-1 mx-auto max-w-7xl px-4 py-10">
        <div class="flex items-end justify-between gap-4">
            <h1 class="text-4xl font-bold">Gallery</h1>
            <div class="flex items-center gap-2 text-sm"><button id="prev" class="btn-outline">Prev</button><span
                    id="pageInfo"></span><button id="next" class="btn-outline">Next</button></div>
        </div>
        <p class="mt-2 text-gray-600">Photos and videos from our classes and events.</p>
        <div class="mt-4 flex flex-wrap gap-2">
            <button class="btn-outline btn-sm ring-2" data-gallery-tab="all">All</button>
            <button class="btn-outline btn-sm" data-gallery-tab="photos">Photos</button>
            <button class="btn-outline btn-sm" data-gallery-tab="videos">Videos</button>
        </div>
        <div id="galleryGrid" class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
        <div id="lightbox" class="lightbox"><img alt="" /></div>
    </main>

    <footer data-shared></footer>
    <script src="../assets/js/site.js" defer></script>
    <script>
        (async function () {
            const grid = document.getElementById('galleryGrid');
            const lb = document.getElementById('lightbox');
            const lbImg = lb.querySelector('img');
            const pageInfo = document.getElementById('pageInfo');
            const prev = document.getElementById('prev');
            const next = document.getElementById('next');
            const tabs = document.querySelectorAll('[data-gallery-tab]');

            const res = await fetch('../assets/data/gallery.json', { cache: 'no-store' });
            const items = await res.json();
            const pageSize = 24; let page = 0; let filter = 'all';

            function getFiltered() {
                if (filter === 'photos') return items.filter(it => (it.type || 'image') === 'image');
                if (filter === 'videos') return items.filter(it => (it.type || 'image') === 'video');
                return items;
            }

            function render() {
                const list = getFiltered();
                grid.innerHTML = '';
                const start = page * pageSize, end = start + pageSize;
                const slice = list.slice(start, end);
                slice.forEach(it => {
                    const type = typeof it === 'string' ? 'image' : (it.type || 'image');
                    const src = typeof it === 'string' ? it : (it.src || '');
                    if (!src) return;
                    if (type === 'video') {
                        const v = document.createElement('video'); v.setAttribute('data-src', src); v.controls = true; v.preload = 'none'; v.className = 'w-full rounded'; grid.appendChild(v);
                    } else {
                        const img = document.createElement('img'); img.src = src; img.alt = 'Gallery photo'; img.loading = 'lazy'; img.className = 'w-full rounded'; grid.appendChild(img);
                    }
                });
                const pages = Math.ceil(list.length / pageSize) || 1;
                if (pageInfo) { pageInfo.textContent = `Page ${page + 1} / ${pages}`; }
                if (prev) { prev.disabled = (page === 0); }
                if (next) { next.disabled = (page >= pages - 1); }
                attachVideoObserver();
            }

            function attachVideoObserver() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(e => {
                        if (e.isIntersecting && e.target.tagName === 'VIDEO' && !e.target.src) {
                            const dataSrc = e.target.getAttribute('data-src');
                            if (dataSrc) { e.target.src = dataSrc; }
                        }
                    });
                }, { rootMargin: '200px' });
                grid.querySelectorAll('video[data-src]').forEach(v => observer.observe(v));
            }

            prev?.addEventListener('click', () => { if (page > 0) { page--; render(); window.scrollTo({ top: 0, behavior: 'smooth' }); } });
            next?.addEventListener('click', () => { const pages = Math.ceil(getFiltered().length / pageSize) || 1; if (page < pages - 1) { page++; render(); window.scrollTo({ top: 0, behavior: 'smooth' }); } });

            tabs.forEach(t => t.addEventListener('click', () => {
                tabs.forEach(x => x.classList.remove('ring-2'));
                t.classList.add('ring-2');
                filter = t.getAttribute('data-gallery-tab');
                page = 0; render();
            }));

            render();

            document.addEventListener('click', (e) => {
                if (e.target.closest('#galleryGrid img')) { lbImg.src = e.target.src; lb.classList.add('open'); }
                if (e.target === lb) { lb.classList.remove('open'); lbImg.src = ''; }
            });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { lb.classList.remove('open'); lbImg.src = ''; } });
        })();
    </script>
</body>

</html>